
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>49</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="aab2e75f-5a0e-46c2-af3a-c23853fd1ce2">A 42-year-old man comes to the
                                        office due to progressive fatigue, nausea, and itchiness.  On review of systems,
                                        the patient admits that he occasionally has bloody stools.  Medical history is
                                        unremarkable.  Examination shows scleral icterus.  Percutaneous liver biopsy is
                                        performed, and histologic analysis of the tissue sample reveals fibrous
                                        obliteration of intrahepatic bile ducts with concentric replacement by
                                        connective tissue.  Which of the following is the most likely diagnosis?</p>
<table class="simple-table" id="56d4f1e5-cfd3-44cc-974d-2839058673b1">
<tbody>
<tr id="8fffeae4-7047-4c12-84ee-76ffd45fd221">
<td class="" id="L;Ph">A.</td>
<td class="" id="&lt;cSE">Autoimmune hepatitis</td>
<td class="" id="odsq"></td>
</tr>
<tr id="e119425e-7252-4c4a-9dc5-9a2f93533b96">
<td class="" id="L;Ph">B.</td>
<td class="" id="&lt;cSE">Cytomegalovirus infection</td>
<td class="" id="odsq"></td>
</tr>
<tr id="07e14dff-f40d-498e-abc6-d34dbe7f8507">
<td class="" id="L;Ph">C.</td>
<td class="" id="&lt;cSE">Hemochromatosis</td>
<td class="" id="odsq"></td>
</tr>
<tr id="ec914663-0c52-49df-913b-a72f1a5e2f6f">
<td class="" id="L;Ph">D.</td>
<td class="" id="&lt;cSE">Primary biliary cholangitis</td>
<td class="" id="odsq"></td>
</tr>
<tr id="cb6b5404-d75b-4da6-b1f6-c3a4f2fc6cfb">
<td class="" id="L;Ph">E.</td>
<td class="" id="&lt;cSE">Primary sclerosing cholangitis</td>
<td class="" id="odsq"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="09fc619a-c2f9-4c0a-8363-4dd2d6e619dd">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="43680325-598a-4940-bae1-933b436e3acc">
<tbody>
<tr id="4479e66e-2d3e-46d7-9233-6bb65953976e">
<td class="" id="JPvy">A.</td>
<td class="" id="x[Gm">Autoimmune hepatitis (3%)</td>
<td class="" id="\=nE"></td>
</tr>
<tr id="86e748c3-ea64-4b0f-9889-c162a321b476">
<td class="" id="JPvy">B.</td>
<td class="" id="x[Gm">Cytomegalovirus infection (0%)</td>
<td class="" id="\=nE"></td>
</tr>
<tr id="1bbc77c7-4040-4de9-b41d-e33e7454f0b8">
<td class="" id="JPvy">C.</td>
<td class="" id="x[Gm">Hemochromatosis (1%)</td>
<td class="" id="\=nE"></td>
</tr>
<tr id="7e8709c4-8966-48ff-a2c1-17c7c362cecc">
<td class="" id="JPvy">D.</td>
<td class="" id="x[Gm">Primary biliary cholangitis (19%)
                                                            </td>
<td class="" id="\=nE"></td>
</tr>
<tr id="921e8f79-adc7-4f01-afb3-8fa99959ed9d">
<td class="" id="JPvy">E.</td>
<td class="" id="x[Gm">Primary sclerosing cholangitis (74%)
                                                            </td>
<td class="" id="\=nE"></td>
</tr>
</tbody>
</table>
<p class="" id="7eefea27-cf82-4691-935a-cc339117e9d3">Incorrect</p>
<p class="" id="3f57a350-8f00-4efd-960a-0a54c5b5dde3">Correct answer E
                                                </p>
<p class="" id="2f523068-9ccb-473c-9927-84492fdd3441">74%Answered
                                                    correctly</p>
<p class="" id="3961ad1f-f97e-4c02-8194-1253d8aaaad9">12 secsTime Spent
                                                </p>
<p class="" id="8ce9aac1-31a7-4db7-a79d-2cf3413404d5">2024Version</p>
<ul class="bulleted-list" id="0820f076-891a-4c3c-a0d9-7605fdee1364">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="eead3ae8-7b9e-45bb-8366-f7cb359ad1fb">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="3abd183f-d234-4694-9f4a-fdb190b41520">
<tbody>
<tr id="8e343fa8-92b2-413f-a7b4-bc08551e3e4b">
<td class="" id="w~&gt;^">Autoimmune liver disease</td>
<td class="" id="Cr=a"></td>
<td class="" id="L&lt;Q`"></td>
<td class="" id="CDu}"></td>
</tr>
<tr id="0f340f56-b3d6-4aa4-bfdc-4b16d40e3b60">
<td class="" id="w~&gt;^"></td>
<td class="" id="Cr=a">Autoimmune<br/>hepatitis<br/></td>
<td class="" id="L&lt;Q`">Primary
                                                                biliary<br/>cholangitis<br/></td>
<td class="" id="CDu}">Primary
                                                                sclerosing<br/>cholangitis<br/></td>
</tr>
<tr id="fa789587-3d65-432e-bea8-80eb2cd55f21">
<td class="" id="w~&gt;^">Epidemiology</td>
<td class="" id="Cr=a">‚Ä¢ Female &gt; male</td>
<td class="" id="L&lt;Q`">‚Ä¢ Female &gt;&gt; male</td>
<td class="" id="CDu}">‚Ä¢ Male &gt; female</td>
</tr>
<tr id="6f3a0ab3-1078-4f2a-bbe1-d202ad7b06d9">
<td class="" id="w~&gt;^">Associations</td>
<td class="" id="Cr=a">‚Ä¢ Other autoimmune disorders</td>
<td class="" id="L&lt;Q`">‚Ä¢ Other autoimmune disorders</td>
<td class="" id="CDu}">‚Ä¢ IBD (particularly UC)</td>
</tr>
<tr id="0f27a0ec-623a-4169-ac54-ed82e2907d0e">
<td class="" id="w~&gt;^">Liver injury<br/>pattern<br/>
</td>
<td class="" id="Cr=a">‚Ä¢ Hepatocellular (‚Üë transaminases)
                                                            </td>
<td class="" id="L&lt;Q`">‚Ä¢ Cholestatic (‚Üë alkaline
                                                                phosphatase)</td>
<td class="" id="CDu}">‚Ä¢ Cholestatic (‚Üë alkaline
                                                                phosphatase)</td>
</tr>
<tr id="bdc2aa7d-8e77-47cf-aa88-ed59c3eb3761">
<td class="" id="w~&gt;^">Antibodies</td>
<td class="" id="Cr=a">‚Ä¢ Anti‚Äìsmooth muscle<br/>‚Ä¢
                                                                Antinuclear*<br/></td>
<td class="" id="L&lt;Q`">‚Ä¢ Antimitochondrial<br/>‚Ä¢
                                                                Antinuclear*<br/></td>
<td class="" id="CDu}">‚Ä¢ ¬± p-ANCA*</td>
</tr>
<tr id="96312158-237f-4531-a952-369b6a7aaa43">
<td class="" id="w~&gt;^">Histology</td>
<td class="" id="Cr=a">‚Ä¢ Interface hepatitis (portal &amp;
                                                                periportal lymphoplasmacytic infiltrate)</td>
<td class="" id="L&lt;Q`">‚Ä¢ Florid duct lesion
                                                                (granulomatous destruction of small bile ducts)</td>
<td class="" id="CDu}">‚Ä¢ Fibrous obliteration of bile ducts
                                                                with concentric periductal deposition of connective
                                                                tissue (onion skin‚Äìlike pattern )</td>
</tr>
<tr id="cc484181-a9b7-45f0-9b81-b32fe64f6ada">
<td class="" id="w~&gt;^">*Nonspecific.<br/>IBD =
                                                                inflammatory bowel disease; p-ANCA = perinuclear
                                                                antineutrophil cytoplasmic antibodies; UC = ulcerative
                                                                colitis.<br/></td>
<td class="" id="Cr=a"></td>
<td class="" id="L&lt;Q`"></td>
<td class="" id="CDu}"></td>
</tr>
</tbody>
</table>
<p class="" id="ac7e03bb-6dcd-4049-a5b6-08a918dd3a7b">This patient with
                                                    fatigue, nausea, pruritus, and scleral icterus has characteristic
                                                    biopsy findings associated with primary sclerosing cholangitis
                                                    (PSC), a chronic disorder characterized by inflammation, fibrosis,
                                                    and stricture of the intrahepatic and extrahepatic bile ducts. 
                                                    Histologic features include fibrous obliteration of the bile ducts
                                                    as well as concentric periductal connective tissue deposition, which
                                                    resembles an onion skin‚Äìlike pattern.  PSC affects men
                                                    disproportionately and has a strong association with ulcerative
                                                    colitis, likely explaining this patient's bloody stools.</p>
<p class="" id="0628346d-b8e0-466a-8f1a-7f8833fb51b9">Manifestations of
                                                    PSC are related to cholestasis and include pruritus, jaundice, and
                                                    fatigue.  Laboratory findings also reflect a cholestatic pattern of
                                                    liver injury and include elevated alkaline phosphatase levels,
                                                    direct hyperbilirubinemia, and normal to mildly elevated
                                                    aminotransferases.  The diagnosis is typically confirmed with
                                                    cholangiography (eg, MR or endoscopic retrograde
                                                    cholangiopancreatography) demonstrating multifocal bile duct
                                                    stricture with segmental dilations.</p>
<p class="" id="4153e574-2926-466e-ba50-9255d459a7cc">(Choice A) 
                                                    Autoimmune hepatitis can cause fatigue, pruritus, and jaundice but
                                                    is characterized histologically by portal and periportal
                                                    lymphoplasmacytic infiltration.  It is usually diagnosed in women
                                                    with other autoimmune conditions (eg, celiac disease).</p>
<p class="" id="88687b45-b461-4cfc-a755-6a19d362da15">(Choice B) 
                                                    Cytomegalovirus infection can cause hepatitis; however, microscopy
                                                    typically reveals large cells with basophilic intracytoplasmic and
                                                    intranuclear inclusions (eg, owl's eye appearance).  In
                                                    addition, it typically occurs in immunocompromised individuals (eg,
                                                    transplant patients).</p>
<p class="" id="26888e8e-994b-42ac-bced-0d751145c47c">(Choice C) 
                                                    Hemochromatosis leads to excessive hepatic iron storage, which
                                                    results in visible iron deposits within hepatocytes.  It is
                                                    typically associated with diabetes, skin hyperpigmentation,
                                                    arthralgias, and cardiomyopathy.</p>
<p class="" id="2c620621-1028-4ae1-8ec7-f343f7594a82">(Choice D) 
                                                    Primary biliary cholangitis also causes cholestasis with jaundice
                                                    and pruritus; however, it is characterized histologically by
                                                    inflammation and granulomatous destruction of the small bile ducts
                                                    (eg, florid duct lesions).  In addition, it is much more common in
                                                    women and is not usually associated with inflammatory bowel disease.
                                                </p>
<p class="" id="c62bbc0e-9c72-4c81-80c4-c2d5d7510417">Educational
                                                    objective:</p>
<p class="" id="6e3edeab-9db6-4e06-b891-646e429b24e6">Primary sclerosing
                                                    cholangitis is characterized by inflammation, fibrosis, and
                                                    stricture of intrahepatic and extrahepatic bile ducts.  Histologic
                                                    findings include fibrous obliteration of bile ducts and concentric
                                                    periductal connective tissue deposition (eg, onion skin‚Äìlike
                                                    pattern).  Manifestations reflect cholestasis and include jaundice,
                                                    pruritus, fatigue, and a cholestatic injury pattern (ie, elevated
                                                    alkaline phosphatase, direct hyperbilirubinemia).</p>
<p class="" id="2333763b-cc56-4936-8385-c15c87c85e3b">Pathology</p>
<p class="" id="44870ec3-bbfa-4a4a-8a17-dccc9a80e0b4">Subject</p>
<p class="" id="0f0fbc86-3e4e-4a2a-8a13-bfb171007010">Gastrointestinal
                                                    &amp; Nutrition</p>
<p class="" id="f4b8c25e-ee60-4256-9b53-8ceae3af679b">System</p>
<p class="" id="80b0dc24-9869-4042-a9d2-9c2f820f7d9c">Primary Sclerosing
                                                    Cholangitis</p>
<p class="" id="cd0a4b10-5b81-4b61-996c-b2899d68b27f">Topic</p>
<p class="" id="39a4c67b-f3e3-44c4-95c9-4871a70e71d1">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="8c72eadd-e919-42f4-896c-e74eb592fbea">‚ú®Done</p>
<p class="" id="62650757-7495-4991-a80a-a0820e30fd24">Exhibit Display
                                                </p>
<figure class="image" id="b986a837-0334-4557-b574-e897f5ee5e63"><a href="https://lh7-us.googleusercontent.com/7x899gVr1x4UzzcPktk90s76H_NEv5Kx7lOKZMOkMRLmk5D2rlk3K1r0CoAZZhUWslLX8X4AlX_jgrz2FPZ-fyeSHHR1J_RVR9Z0_M7XZgTscWPLY4JbbwFrJivs3-1A48ot4pJrjNKRh16FIDz5luM"><img loading="lazy" src="https://lh7-us.googleusercontent.com/7x899gVr1x4UzzcPktk90s76H_NEv5Kx7lOKZMOkMRLmk5D2rlk3K1r0CoAZZhUWslLX8X4AlX_jgrz2FPZ-fyeSHHR1J_RVR9Z0_M7XZgTscWPLY4JbbwFrJivs3-1A48ot4pJrjNKRh16FIDz5luM" style="width:602px"/></a>
</figure>
<p class="" id="3717381a-27ae-4ebd-8d16-d8a3790f3991">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="d4c6e87b-d438-46ea-9398-67fd7855d605">ExistingMy
                                                    Notebook</p>
<p class="" id="78dd87a5-9880-4e59-9207-5628cc980a41">Exhibit Display
                                                </p>
<figure class="image" id="48013c40-5d42-4f67-a732-dde2b7cee25a"><a href="https://lh7-us.googleusercontent.com/m56MV9ft9_StoGrBr5k3pI0OPH95NwVTFEikpsgzFoiHTVSOSvyXFeTutTFf_NoaWyYS6MdITG_rOWxiH1fI8yEPCGNbKwER3ex_HeZS9LgmN-Kv548ktU79AVeISNnn-M8IdNzGlJRr289Nyo1Pn6U"><img loading="lazy" src="https://lh7-us.googleusercontent.com/m56MV9ft9_StoGrBr5k3pI0OPH95NwVTFEikpsgzFoiHTVSOSvyXFeTutTFf_NoaWyYS6MdITG_rOWxiH1fI8yEPCGNbKwER3ex_HeZS9LgmN-Kv548ktU79AVeISNnn-M8IdNzGlJRr289Nyo1Pn6U" style="width:602px"/></a>
</figure>
<p class="" id="dec88933-537f-4d9a-8316-801833561880">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="c1fc0cb1-4b40-46b7-bc34-73c2b863ce4e">ExistingMy
                                                    Notebook</p>
<p class="" id="e2422d18-bf02-46e9-a335-5b8979835ce7">Exhibit Display
                                                </p>
<figure class="image" id="c8eaef98-b248-4d5a-9229-f0344cf80823"><a href="https://lh7-us.googleusercontent.com/qa7WMNPXYC9QasZB0cpUE3hNo9APGGnsfpx9DlxiT21oeObvuwfQwrTrwyQJ8FdXm_1hxeDqTGXRlzjsOlSQrmnoT2rsPhf378BWiPxZLZqyejom4AR_Tk31AVcLseSCJajul_BQaDx7eWzqyTGOTtw"><img loading="lazy" src="https://lh7-us.googleusercontent.com/qa7WMNPXYC9QasZB0cpUE3hNo9APGGnsfpx9DlxiT21oeObvuwfQwrTrwyQJ8FdXm_1hxeDqTGXRlzjsOlSQrmnoT2rsPhf378BWiPxZLZqyejom4AR_Tk31AVcLseSCJajul_BQaDx7eWzqyTGOTtw" style="width:602px"/></a>
</figure>
<p class="" id="9476fd3e-11fc-4bbc-a10a-24d766c73f15">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="07024ea5-c1fd-40c9-b199-c56795ad2f31">ExistingMy
                                                    Notebook</p>
<p class="" id="75226bab-edbc-46c9-b9ae-560fc43a4cfb">Exhibit Display
                                                </p>
<figure class="image" id="3c93335e-6dc0-4c75-9286-ddae66ff2090"><a href="https://lh7-us.googleusercontent.com/_1_emMVTTW5gg3uuxcY0IY72eMUzPjlQfGlhanyobN4NvPqcg5xm9wrP5A8tqJJe6L480JDAEWEhvVkf7wmSduyI11vmlHs0O2nGbmBAYhiiG0EOSfDq_g6lrLMQ05ZrRyB6quszubRXLUGGU5urBWY"><img loading="lazy" src="https://lh7-us.googleusercontent.com/_1_emMVTTW5gg3uuxcY0IY72eMUzPjlQfGlhanyobN4NvPqcg5xm9wrP5A8tqJJe6L480JDAEWEhvVkf7wmSduyI11vmlHs0O2nGbmBAYhiiG0EOSfDq_g6lrLMQ05ZrRyB6quszubRXLUGGU5urBWY" style="width:602px"/></a>
</figure>
<p class="" id="4b89337a-33ed-442d-8bd8-2132ce33e937">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="d0c5277d-66b6-45ab-89f6-68574824af1a">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }


    


    

    /* Adjust table padding to make room for radio button */
    


    


    


    


    /* Clickable Answer Choices */
    table tr.answer-choice {
        cursor: pointer !important;
        transition: all 0.3s ease !important;
    }

    table tr.answer-choice:hover {
        background: #f8f9fa !important;
    }

    table tr.answer-choice td:first-child {
        position: relative !important;
        padding-left: 35px !important;
    }

    table tr.answer-choice td:first-child::before {
        content: '';
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        border: 2px solid #999;
        border-radius: 50%;
        background: white;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }

    table tr.answer-choice.selected td:first-child::before {
        border-color: #1a73e8;
        border-width: 5px;
    }

    table tr.answer-choice.selected {
        background: #e8f4ff !important;
    }

    table tr.answer-choice.selected td:first-child {
        color: #1a73e8 !important;
        font-weight: 600 !important;
    }


    


    /* Answer Validation Styles */
    tr.answer-choice.answer-correct {
        background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%) !important;
        border: 3px solid #28a745 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3) !important;
    }

    tr.answer-choice.answer-correct td {
        color: #155724 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-correct td:first-child::before {
        border-color: #28a745 !important;
        background: #28a745 !important;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2) !important;
    }

    tr.answer-choice.answer-incorrect {
        background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%) !important;
        border: 3px solid #dc3545 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3) !important;
    }

    tr.answer-choice.answer-incorrect td {
        color: #721c24 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-incorrect td:first-child::before {
        border-color: #dc3545 !important;
        background: #dc3545 !important;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2) !important;
    }


    /* Answer Validation Styles */
    tr.answer-choice.answer-correct {
        background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%) !important;
        border: 3px solid #28a745 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3) !important;
    }

    tr.answer-choice.answer-correct td {
        color: #155724 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-correct td:first-child::before {
        border-color: #28a745 !important;
        background: #28a745 !important;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2) !important;
    }

    tr.answer-choice.answer-incorrect {
        background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%) !important;
        border: 3px solid #dc3545 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3) !important;
    }

    tr.answer-choice.answer-incorrect td {
        color: #721c24 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-incorrect td:first-child::before {
        border-color: #dc3545 !important;
        background: #dc3545 !important;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2) !important;
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>







<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Communicate with parent window (if in iframe)
    function notifyParent(choice) {
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'choiceSelected',
                questionId: getQuestionId(),
                choice: choice
            }, '*');
        }
    }

    // Load saved choice from parent or localStorage
    function loadSavedChoice() {
        const questionId = getQuestionId();

        // Try to get from localStorage first
        const saved = localStorage.getItem('choice_q' + questionId);
        if (saved) {
            selectChoice(saved, false);
        }

        // Ask parent for saved choice (if in iframe)
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'getChoice',
                questionId: questionId
            }, '*');
        }
    }

    // Listen for messages from parent
    window.addEventListener('message', function(event) {
        if (event.data.type === 'setChoice' && event.data.questionId === getQuestionId()) {
            selectChoice(event.data.choice, false);
        }
    });

    // Select a choice
    function selectChoice(choice, notify = true) {
        if (!choice) return;

        const questionId = getQuestionId();

        // Remove previous selection
        document.querySelectorAll('tr.answer-choice').forEach(row => {
            row.classList.remove('selected');
        });

        // Add selection to clicked choice
        const choiceRow = document.querySelector(`tr.answer-choice[data-choice="${choice}"]`);
        if (choiceRow) {
            choiceRow.classList.add('selected');

            // Save to localStorage
            localStorage.setItem('choice_q' + questionId, choice);

            // Notify parent (if in iframe)
            if (notify) {
                notifyParent(choice);
            }
        }
    }

    // Initialize answer choices
    function initializeChoices() {
        // Find all answer choice rows (A, B, C, D, E, F, etc.)
        const choicePattern = /^[A-Z]\.$/;
        const tables = document.querySelectorAll('table.simple-table');

        tables.forEach(table => {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell && choicePattern.test(firstCell.textContent.trim())) {
                    const choice = firstCell.textContent.trim().replace('.', '');
                    row.classList.add('answer-choice');
                    row.setAttribute('data-choice', choice);
                    row.style.position = 'relative';

                    // Add click handler
                    row.addEventListener('click', function(e) {
                        // Don't trigger if clicking inside a link or button
                        if (e.target.tagName === 'A' || e.target.closest('a')) return;

                        // Toggle selection
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            const questionId = getQuestionId();
                            localStorage.removeItem('choice_q' + questionId);
                            notifyParent('');
                        } else {
                            selectChoice(choice);
                        }
                    });
                }
            });
        });

        // Load saved choice after a short delay
        setTimeout(loadSavedChoice, 100);
    }

    // Run when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChoices);
    } else {
        initializeChoices();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);

                    // Notify parent that Submit/Explanation was opened
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'submitOpened',
                            questionId: getQuestionId()
                        }, '*');
                    }
                } else {
                    // Notify parent that Submit/Explanation was closed
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'submitClosed',
                            questionId: getQuestionId()
                        }, '*');
                    }
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>
